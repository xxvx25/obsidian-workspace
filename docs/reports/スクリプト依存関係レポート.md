# スクリプト依存関係レポート

作成日: 2025-01-28

## 概要

このワークスペース内の各スクリプトの依存関係を確認し、動作状況を検証しました。

## 検出されたスクリプト一覧

### Pythonスクリプト

#### 1. `projects/tools/scripts/ai_code_review.py`
**説明**: AIを使用したコードレビュースクリプト。pre-commitフックから呼び出される。
- **機能**: コメントと実装の齟齬、実装の不備、typo、ドキュメント文字列と実装の不一致を検出
- **依存関係**:
  - `agents.literature.cached_llm_client.CachedLLMClient` ❌ **問題あり**
  - `ANTHROPIC_API_KEY` 環境変数が必要
- **問題点**: 
  - `cached_llm_client.py` が空ファイル（0行）のため、インポート不可
  - このスクリプトは動作しない状態

#### 2. `external_brain2/06_development/scripts/rotate_and_ocr_pdf.py`
**説明**: PDFを時計回りで90度回転させ、Yomitokuでテキストレイヤーを上書きするスクリプト
- **機能**: PDF回転 + OCR処理
- **依存関係**:
  - `PyMuPDF` (fitz) ❌ **未インストール**
  - `yomitoku` コマンド ❌ **未インストール**
- **問題点**: 
  - 必要な依存関係がインストールされていない
  - `uv add pymupdf` と `uv add yomitoku` が必要

#### 3. `external_brain2/06_development/scripts/market_allocator.py`
**説明**: 市場の温度感を判定し、毎月の入金配分（Dynamic Inflow）を決定するスクリプト
- **機能**: 市場分析と投資配分の推奨
- **依存関係**:
  - `yfinance` ❌ **未インストール**
  - `pandas` ❌ **未インストール**
  - `numpy` ❌ **未インストール**
- **問題点**: 
  - 必要な依存関係がインストールされていない
  - `uv add yfinance pandas numpy` が必要

#### 4. `projects/user/projects/zotero-obsidian-pipeline/run_automated_pipeline.py`
**説明**: ZoteroからObsidianへの自動パイプライン実行スクリプト
- **機能**: Zoteroアイテムを処理してObsidian Markdownファイルを生成
- **依存関係**:
  - `loguru` ❌ **未インストール**
  - `rich` ❌ **未インストール**
  - `pipeline_orchestrator` (ローカルモジュール)
  - `pyzotero` ❌ **未インストール**
- **問題点**: 
  - 必要な依存関係がインストールされていない
  - `uv add loguru rich pyzotero` が必要

#### 5. `external_brain2/06_development/agents/writing/writing_agent.py`
**説明**: 執筆支援エージェント
- **機能**: 草稿生成、引用生成、論理構造構築
- **依存関係**:
  - `DraftGenerator`, `CitationGenerator`, `StructureBuilder` 等（ローカルモジュール）
  - `yaml`
  - `asyncio`
- **状態**: ローカル依存関係の確認が必要

#### 6. `external_brain2/06_development/agents/writing/quarto_generator.py`
**説明**: Quarto形式（.qmd）ファイル生成エンジン
- **機能**: YAMLフロントマター生成、@citekey形式での本文出力
- **依存関係**:
  - `yaml`
  - `pathlib`
- **状態**: 標準ライブラリのみ使用、問題なし

### シェルスクリプト

#### 1. `projects/tools/scripts/git-branch-suggest.sh`
**説明**: 推奨ブランチ名を出力する軽量CLI（grep/sedのみ）
- **機能**: Git変更内容から適切なブランチ名を提案
- **依存関係**:
  - `git` ✅ 利用可能
  - `grep`, `sed`, `awk` ✅ 標準コマンド
- **状態**: 問題なし

#### 2. `projects/tools/scripts/test-branch-hooks.sh`
**説明**: ブランチフックのテストスクリプト
- **状態**: ファイルが空（0行）

#### 3. `projects/tools/scripts/check-footnotes.sh`
**説明**: 脚注位置チェックスクリプト
- **機能**: textlintを使用して脚注の位置をチェック
- **依存関係**:
  - `npx` ✅ 利用可能 (`/opt/homebrew/bin/npx`)
  - `textlint` パッケージ（npm経由でインストールが必要）
  - `textlint-rules/footnote-position.js` ルール
- **問題点**: 
  - `npm install` が必要な可能性
  - `textlint-rules/footnote-position.js` の存在確認が必要

#### 4. `external_brain2/agents/tools/claude-launch.sh`
**説明**: Claude起動スクリプト
- **状態**: ファイルが空（0行）

#### 5. `external_brain2/agents/tools/cursor-launch.sh`
**説明**: Cursor起動スクリプト
- **状態**: ファイルが空（0行）

#### 6. `external_brain2/agents/tools/codex-launch.sh`
**説明**: Codex起動スクリプト
- **状態**: ファイルが空（0行）

#### 7. `external_brain2/agents/tools/gemini-launch.sh`
**説明**: Gemini起動スクリプト
- **状態**: ファイルが空（0行）

### その他のスクリプト

#### 1. `zotero_mcp_server.py`
**説明**: Zotero MCPサーバー
- **状態**: ファイルが空（0行）

## 依存関係の問題点まとめ

### 重大な問題

1. **`cached_llm_client.py` が空ファイル**
   - 場所: `external_brain2/06_development/agents/literature/cached_llm_client.py`
   - 影響: `ai_code_review.py` が動作しない
   - 対応: 実装が必要

2. **Pythonパッケージの未インストール**
   - `yfinance`, `pandas`, `numpy` → `market_allocator.py` に必要
   - `PyMuPDF` (fitz) → `rotate_and_ocr_pdf.py` に必要
   - `loguru`, `rich`, `pyzotero` → `run_automated_pipeline.py` に必要

3. **外部コマンドの未インストール**
   - `yomitoku` → `rotate_and_ocr_pdf.py` に必要

4. **空ファイルのスクリプト**
   - 複数のシェルスクリプトとPythonスクリプトが空（0行）
   - 実装が必要または不要なファイルの可能性

### 推奨される対応

1. **依存関係のインストール**
   ```bash
   # Pythonパッケージのインストール
   uv add yfinance pandas numpy pymupdf loguru rich pyzotero
   
   # yomitokuのインストール
   uv add yomitoku
   ```

2. **`cached_llm_client.py` の実装**
   - `CachedLLMClient` クラスの実装が必要
   - `ai_code_review.py` が正常に動作するために必須

3. **空ファイルの確認**
   - 不要な場合は削除
   - 必要な場合は実装

4. **環境変数の設定**
   - `ANTHROPIC_API_KEY` の設定が必要（`ai_code_review.py` 用）

## 動作確認済みのスクリプト

- ✅ `git-branch-suggest.sh` - 標準コマンドのみ使用、問題なし
- ✅ `quarto_generator.py` - 標準ライブラリのみ使用、問題なし

## システム環境

- **Python**: 3.9.6 (`/usr/bin/python3`)
- **uv**: 利用可能 (`/Users/tennigo/.local/bin/uv`)
- **npx**: 利用可能 (`/opt/homebrew/bin/npx`)
- **git**: 利用可能

## 次のステップ

1. 必要なPythonパッケージをインストール
2. `cached_llm_client.py` を実装
3. 空ファイルのスクリプトを確認・実装または削除
4. 環境変数の設定
5. 各スクリプトの動作テスト

